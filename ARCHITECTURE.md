# SecureGate - How It Works

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GitHub Actions Runner                    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Step 1: Setup Environment                         â”‚    â”‚
â”‚  â”‚  â€¢ Install Python 3.11                             â”‚    â”‚
â”‚  â”‚  â€¢ Install OSV Scanner                             â”‚    â”‚
â”‚  â”‚  â€¢ Install Dart SDK & pana                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Step 2: Load Configuration                        â”‚    â”‚
â”‚  â”‚  â€¢ Read .github/security-gate.yml                  â”‚    â”‚
â”‚  â”‚  â€¢ Apply defaults if not found                     â”‚    â”‚
â”‚  â”‚  â€¢ mode, banned_licenses, threshold, etc.          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Step 3: Vulnerability Scan (OSV Scanner)          â”‚    â”‚
â”‚  â”‚  â€¢ Scan pubspec.lock for vulnerabilities           â”‚    â”‚
â”‚  â”‚  â€¢ Classify by severity (INFO â†’ CRITICAL)          â”‚    â”‚
â”‚  â”‚  â€¢ Filter by ignore lists                          â”‚    â”‚
â”‚  â”‚  â†’ Output: osv-report.json                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Step 4: License Detection                         â”‚    â”‚
â”‚  â”‚  â€¢ Extract dependencies from pubspec.lock          â”‚    â”‚
â”‚  â”‚  â€¢ Analyze licenses via pana                       â”‚    â”‚
â”‚  â”‚  â€¢ Compare against banned list                     â”‚    â”‚
â”‚  â”‚  â†’ Output: license-report.json                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Step 5: Policy Enforcement                        â”‚    â”‚
â”‚  â”‚  â€¢ Apply severity threshold                        â”‚    â”‚
â”‚  â”‚  â€¢ Check whitelist/ignore lists                    â”‚    â”‚
â”‚  â”‚  â€¢ Decide: PASS or FAIL                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Step 6: Generate Reports                          â”‚    â”‚
â”‚  â”‚  â€¢ Create report.md (human readable)               â”‚    â”‚
â”‚  â”‚  â€¢ Create final-report.json (machine readable)     â”‚    â”‚
â”‚  â”‚  â€¢ Upload as artifacts                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Step 7: Post Results                              â”‚    â”‚
â”‚  â”‚  â€¢ If PR: Post comment with findings               â”‚    â”‚
â”‚  â”‚  â€¢ Set action outputs                              â”‚    â”‚
â”‚  â”‚  â€¢ Exit with appropriate code                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Result                                            â”‚    â”‚
â”‚  â”‚  â€¢ mode=block â†’ CI passes or fails                 â”‚    â”‚
â”‚  â”‚  â€¢ mode=annotate â†’ CI passes, comments added       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Client Workflow

```
Developer                    GitHub                    SecureGate
    |                           |                           |
    |--[1] Push code/PR-------->|                           |
    |                           |                           |
    |                           |--[2] Trigger workflow---->|
    |                           |                           |
    |                           |                           |--[3] Scan project
    |                           |                           |    â€¢ Check vulnerabilities
    |                           |                           |    â€¢ Check licenses
    |                           |                           |
    |                           |<--[4] Post results--------|
    |                           |                           |
    |<--[5] See PR comment------|                           |
    |<--[6] CI pass/fail--------|                           |
    |                           |                           |
    |--[7] Fix issues---------->|                           |
    |                           |                           |
    |                           |--[8] Re-scan------------->|
    |                           |                           |
    |<--[9] Pass----------------|<--[10] All clear----------|
```

## Configuration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User's Repository                                  â”‚
â”‚                                                     â”‚
â”‚  .github/                                           â”‚
â”‚  â”œâ”€â”€ workflows/                                     â”‚
â”‚  â”‚   â””â”€â”€ security.yml â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚       (Calls SecureGate)     â”‚                  â”‚
â”‚  â”‚                               â”‚                  â”‚
â”‚  â””â”€â”€ security-gate.yml â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚      (User configuration)         â”‚          â”‚      â”‚
â”‚                                   â”‚          â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜
                                    â†“          â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   SecureGate Action       â”‚
                        â”‚                           â”‚
                        â”‚   1. Load config          â”‚
                        â”‚   2. Apply defaults       â”‚
                        â”‚   3. Run scanner.py       â”‚
                        â”‚   4. Generate reports     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Decision Tree

```
                        [SecureGate Runs]
                              |
                              â†“
                    [Load Configuration]
                              |
                              â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                               â”‚
              â†“                               â†“
    [Scan Vulnerabilities]         [Check Licenses]
              â”‚                               â”‚
              â†“                               â†“
    [Filter by severity]          [Compare vs banned list]
    [Apply ignore lists]          [Apply whitelist]
              â”‚                               â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    [Policy Enforcement]
                              |
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚
                    â†“                   â†“
              [Issues Found]      [No Issues]
                    â”‚                   â”‚
                    â†“                   â†“
              [Check Mode]         [âœ“ PASS]
                    |
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚
         â†“                     â†“
    [mode=block]         [mode=annotate]
         â”‚                     â”‚
         â†“                     â†“
    [âŒ FAIL]            [âœ“ PASS]
    [Block CI]           [Comment only]
```

## Severity Classification

```
Vulnerabilities are classified into 5 levels:

CRITICAL (9.0-10.0) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚
HIGH (7.0-8.9) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                             â”œâ”€ [Severity Threshold]
MEDIUM (4.0-6.9) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  (Default: HIGH)
                             â”‚  Only these trigger action
LOW (0.1-3.9) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                             â”‚
INFO (0.0) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

```
pubspec.lock
    â”‚
    â”œâ”€â”€> [OSV Scanner] â”€â”€> osv-report.json â”€â”€â”
    â”‚                                         â”‚
    â””â”€â”€> [pana analyzer] â”€â”€> license data â”€â”€â”€â”¤
                                              â”‚
                                              â†“
                                    [scanner.py combines]
                                              â”‚
                                              â†“
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                            â”‚
                              â†“                            â†“
                        report.md                  final-report.json
                              â”‚                            â”‚
                              â†“                            â†“
                        [PR Comment]                  [Artifact]
```

## Example: Real Execution

```
ðŸš€ Starting SecureGate scan...

Working directory: /github/workspace
Mode: block
Severity threshold: HIGH

ðŸ” Running OSV Scanner...
âœ“ OSV scan complete

ðŸ“œ Scanning licenses...
âœ“ License scan complete. Found 1 issues

âš–ï¸  Applying security policy...
âš  Found 2 vulnerabilities at or above HIGH severity
âš  Found 1 license violations
âŒ Blocking due to security/license issues

ðŸ“Š Generating reports...
âœ“ Reports generated: report.md, final-report.json

ðŸ’¬ Posting comment to PR #42...
âœ“ Comment posted successfully

âŒ Security scan FAILED
```

## Integration Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  External Tools & Services                      â”‚
â”‚                                                 â”‚
â”‚  [Google OSV Database] â†â”€â”€ OSV Scanner          â”‚
â”‚  [pub.dev] â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ pana analyzer        â”‚
â”‚  [GitHub API] â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  PR Comments         â”‚
â”‚  [GitHub Actions] â†â”€â”€â”€â”€â”€â”€â”€â”€ Workflow execution  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
            [SecureGate Action]
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Outputs                                        â”‚
â”‚                                                 â”‚
â”‚  â€¢ Pull Request Comments                        â”‚
â”‚  â€¢ CI Pass/Fail Status                          â”‚
â”‚  â€¢ Artifact Reports                             â”‚
â”‚  â€¢ Action Outputs (variables)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Relationships

```
action.yml (Entry point)
    â”‚
    â”œâ”€> [Setup Steps]
    â”‚   â”œâ”€> Install Python
    â”‚   â”œâ”€> Install OSV Scanner  
    â”‚   â”œâ”€> Install Dart/pana
    â”‚   â””â”€> Install requirements.txt
    â”‚
    â””â”€> [Run scanner.py] â”€â”€â”€â”€â”
                             â”‚
                             â†“
                    scanner.py (Core logic)
                             â”‚
                             â”œâ”€> Read security-gate.yml
                             â”œâ”€> Call OSV Scanner
                             â”œâ”€> Call pana
                             â”œâ”€> Apply policy
                             â”œâ”€> Generate reports
                             â””â”€> Post PR comment
```

---

For client setup instructions, see [CLIENT_SETUP.md](CLIENT_SETUP.md)
